<!DOCTYPE html>
<html>
<head>
  <title>CONZQ</title>
	<link href='http://fonts.googleapis.com/css?family=Fira+Sans:300,500' rel='stylesheet' type='text/css'>
  <%= stylesheet_link_tag    "application", media: "all" %>
  <%= javascript_include_tag "application" %>

  <%= csrf_meta_tags %>
</head>
<body>
	
	<header class="header">
		<section class="group">
			<a class="logo" href="#">CONZQ</a>

			<ul class="nav">
				<li><a class="discover" href="#">Discover</a></li>
				<li class="search">
					<a id="search" href="#">Search</a>
					
					<div class="search-input">
						<form action="<%= text_search_url %>" method="get">
							<input type="text" name="query" value="<%= params[:query] %>">
						</form>
					</div>
				</li>
				
				<% if signed_in? %>
				<li><a href="<%= user_url(current_user) %>">
					<%= current_user.username %>
				</a></li>
					
				<li class="signed-in">	
					<p class="triangle" href="#">â–¼</p>

					<ul class="profile-dropdown">
						<% if current_user.admin %>
						<li>
							<a href="<%= tv_shows_url %>">My Series</a>
						</li>
						
						<li>
							<a href="<%= new_tv_url %>">Add a Series</a>
						</li>
						<% end %>
						
						<li>
							<a href="<%= user_url(current_user) %>">My Profile</a>
						</li>
						
						<li>
							<a href="#">Settings</a>
						</li>
						
						<li>
							<%= link_to "Logout", session_url, method: "delete" %>
						</li>
					</ul>
				</li>
				<% else %>
				
				<li><a href="<%= new_session_url %>">Sign In</a></li>
				<li><a href="<%= new_user_url %>">Create an account</a></li>
				
				<% end %>
			</ul>
		</section>
	</header>

<main class="container">
	<!-- SIDEBAR -->
	
	<section class="main"><%= yield %></section>
</main>

<% if current_user %>
<script>
	window.currentUser = { id: <%= current_user.id %> };
</script>
<% end %>


<script>
$(document).ready(function(){
	var $container = $("main.container");
	var $sidebar = $("<section>").addClass("sidebar");
	var $main = $("section.main");


  CONZQ.initialize($container, $sidebar, $main);
	
	$("abbr.timeago").timeago();
	
	<% if session[:sidebar] == "true" %>
	$container.addClass("open");
	<% end %>
	
	$("input").on("focus", function () {
		$(this).val("");
	})
	
	
	$("a.discover").on("click", function () {
		event.preventDefault();
		$container.toggleClass("open");
		
		// if $container hasClass open 
		// session[:sidebar] == true
		// else session[:sidebar] == false
	});
	
	
	// removeClass on blur!!!
	$("a#search").on("click", function () {
		event.preventDefault();
		$("li.search").toggleClass("open");
	});
	
	$(".signed-in").on("click", function () {
		$(".profile-dropdown").toggleClass("open");
	});
	
});
</script>
</body>
</html>
